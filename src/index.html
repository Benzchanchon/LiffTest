<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div>
        <div id="lineprofile" style="display:none;">
            <img id="profilePicture" width="100px" src="" >
            <div id="displayName">hello name</div>
            <div id="userId">UID: Your UID</div>
            <button id="logoutButton" style="display:none;">Logout</button> <!-- ปุ่ม Logout -->
        </div>
    </div>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/versions/2.22.3/sdk.js"></script>
    <script>
        const main = async () => {  //สร้างฟังชั่น main
            try {
                await liff.init({ liffId: "2005552640-X4EbjzBR" });  // await=รอ รอการตั้งค่า LIFF ด้วย LIFF ID ที่กำหนดไว้
                console.log('LIFF initialized');
                
                if (!liff.isLoggedIn()) { // หากผู้ใช้ยังไม่ได้ล็อกอิน ให้ทำการล็อกอิน
                    console.log('User not logged in, logging in...');
                    liff.login();
                } else {  //ถ้าผู้ใช้ได้ล็อกอินแล้วจะดึงข้อมูลโปรไฟล์มาใช้
                    console.log('User logged in');
                    const profile = await liff.getProfile();
                    console.log('Profile:', profile);
                    document.getElementById("profilePicture").src = profile.pictureUrl;  //อัพเดทรูปโปรไฟล์
                    document.getElementById("displayName").textContent = `Hello, ${profile.displayName}`; //    อัพเดทชื่อผู้ใช้
                    document.getElementById("userId").textContent = `UID: ${profile.userId}`; //อัพเดท UID
                    document.getElementById("lineprofile").style.display = 'block';  // แสดงข้อมูลโปรไฟล์
                    document.getElementById("logoutButton").style.display = 'block';  // แสดงปุ่ม Logout
                }
            } catch (error) {
                console.error('LIFF Initialization failed', error);  // ถ้ามีข้อผิดพลาดในการตั้งค่า LIFF ให้แสดงข้อผิดพลาดใน console
            }
        }

        const logout = () => {  // ฟังก์ชัน Logout
            console.log('Logging out...');
            liff.logout();
            window.location.reload();  // Reload หน้าเว็บหลังจาก Logout
        }

        document.getElementById("logoutButton").addEventListener("click", logout);  // เพิ่ม Event Listener สำหรับปุ่ม Logout

        main(); //เรียกใช้ฟังชั่น main
    </script>
</body>
</html>
